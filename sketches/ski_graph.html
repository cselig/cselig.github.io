<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>cselig</title><link rel="icon" href="favicon.ico"/><meta name="next-head-count" content="4"/><link rel="preload" href="/_next/static/css/62ae7adc418c4fa89ac0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/62ae7adc418c4fa89ac0.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c50983a0f67670336377.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c50983a0f67670336377.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-eda8c26f5cd99e38033b.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-af0eec40afefd136e556.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.33edf24cd040bcfe1fae.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.29943283c3fbe2fae039.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-b1f8c6974db848249dda.js" as="script"/><link rel="preload" href="/_next/static/chunks/fb7d5399.3234374f6f7b41b7b467.js" as="script"/><link rel="preload" href="/_next/static/chunks/fe66c3e56503ac18952228a608ca3464c3766972.f6010f132f2f6ed87439.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/sketches/%5Bid%5D-9e30c1cc5c676b5407a0.js" as="script"/></head><body><div id="__next"><div class="layout_container__3H2Qg"><svg class="MuiSvgIcon-root layout_back_button__-f7Kp" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></svg><h1 class="sketch_title__2-Xm5">Ski Graphs</h1><div><p>I recently went skiing at Heavenly resort in South Lake Tahoe, and the process of studying the trail map and picking
out routes got me thinking about how a ski resort is basically a big directed graph (assuming you stay "on-piste").</p>
<p>This inspired me to make a little widget that would find shortest paths between two points in the resort. The result
is a simplified version of Heavenly that doesn't include the parts that were closed when I was there and
also doesn't include advanced terrain that I can't ski down (yet). The grey edges are the chairlifts, and the other edges
are the runs color-coded by level.</p>
<p>To find a path, click on a start and end node.</p>
</div><div><div id="ski-graph" class="ski_graph_ski_graph__ocngU"><p class="ski_graph_text__ojjcz">Pick start</p><svg width="500" height="500"></svg></div></div><h2>Code:</h2><div><pre style="-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre-wrap;word-wrap:normal;font-family:Menlo, Monaco, &quot;Courier New&quot;, monospace;font-size:14px;color:#76d9e6;text-shadow:none;background:#2a2a2a;padding:15px;border-radius:4px;border:1px solid #e1e1e8;overflow:auto;position:relative"><code class="language-javascript" style="-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;white-space:pre;word-wrap:normal;font-family:Menlo, Monaco, &quot;Courier New&quot;, monospace;font-size:14px;color:#76d9e6;text-shadow:none"><span class="token module" style="color:#ef3b7d">import</span><span> </span><span class="token imports maybe-class-name">React</span><span> </span><span class="token module" style="color:#ef3b7d">from</span><span> </span><span class="token" style="color:#e6d06c">&#x27;react&#x27;</span><span>
</span><span></span><span class="token module" style="color:#ef3b7d">import</span><span> </span><span class="token imports" style="color:#a77afe">*</span><span class="token imports"> </span><span class="token imports module" style="color:#ef3b7d">as</span><span class="token imports"> d3</span><span> </span><span class="token module" style="color:#ef3b7d">from</span><span> </span><span class="token" style="color:#e6d06c">&#x27;d3&#x27;</span><span>
</span>
<span></span><span class="token module" style="color:#ef3b7d">import</span><span> </span><span class="token imports" style="color:#a77afe">*</span><span class="token imports"> </span><span class="token imports module" style="color:#ef3b7d">as</span><span class="token imports"> graphUtils</span><span> </span><span class="token module" style="color:#ef3b7d">from</span><span> </span><span class="token" style="color:#e6d06c">&#x27;../../lib/graph_utils.js&#x27;</span><span>
</span>
<span></span><span class="token module" style="color:#ef3b7d">import</span><span> </span><span class="token imports">nodesData</span><span> </span><span class="token module" style="color:#ef3b7d">from</span><span> </span><span class="token" style="color:#e6d06c">&#x27;../../data/graphs/heavenly/nodes.json&#x27;</span><span>
</span><span></span><span class="token module" style="color:#ef3b7d">import</span><span> </span><span class="token imports">edgesData</span><span> </span><span class="token module" style="color:#ef3b7d">from</span><span> </span><span class="token" style="color:#e6d06c">&#x27;../../data/graphs/heavenly/edges.json&#x27;</span><span>
</span>
<span></span><span class="token module" style="color:#ef3b7d">import</span><span> </span><span class="token imports">styles</span><span> </span><span class="token module" style="color:#ef3b7d">from</span><span> </span><span class="token" style="color:#e6d06c">&#x27;../../styles/sketches/ski_graph.module.scss&#x27;</span><span>
</span>
<span></span><span class="token" style="color:#ef3b7d">const</span><span> </span><span class="token constant">SVG_WIDTH</span><span> </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#a77afe">500</span><span class="token" style="color:#bebec5">,</span><span>
</span><span>      </span><span class="token constant">SVG_HEIGHT</span><span> </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#a77afe">500</span><span>
</span>
<span></span><span class="token" style="color:#ef3b7d">const</span><span> colorMap </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>  </span><span class="token" style="color:#e6d06c">&quot;blue&quot;</span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token" style="color:#e6d06c">&quot;#1E88E5&quot;</span><span class="token" style="color:#bebec5">,</span><span>
</span><span>  </span><span class="token" style="color:#e6d06c">&quot;green&quot;</span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token" style="color:#e6d06c">&quot;#229954&quot;</span><span>
</span><span></span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span></span><span class="token" style="color:#ef3b7d">const</span><span> delay </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#a77afe">500</span><span>
</span><span></span><span class="token" style="color:#ef3b7d">const</span><span> </span><span class="token function-variable function">fadeInText</span><span>  </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">select</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;#ski-graph .text&quot;</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">transition</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">duration</span><span class="token" style="color:#bebec5">(</span><span>delay</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">style</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;opacity&quot;</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">)</span><span>
</span><span></span><span class="token" style="color:#ef3b7d">const</span><span> </span><span class="token function-variable function">fadeOutText</span><span> </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">select</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;#ski-graph .text&quot;</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">transition</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">duration</span><span class="token" style="color:#bebec5">(</span><span>delay</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">style</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;opacity&quot;</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">0</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span></span><span class="token" style="color:#6f705e">// moving these functions out of graphUtils for now.</span><span>
</span><span></span><span class="token" style="color:#ef3b7d">function</span><span> </span><span class="token function">makeAdjacencyList</span><span class="token" style="color:#bebec5">(</span><span class="token parameter">edges</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> nodes</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>  </span><span class="token" style="color:#ef3b7d">let</span><span> adjacencyList </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#ef3b7d">new</span><span> </span><span class="token class-name">Map</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>  </span><span class="token control-flow" style="color:#ef3b7d">for</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">const</span><span> </span><span class="token" style="color:#bebec5">{</span><span>start</span><span class="token" style="color:#bebec5">,</span><span> end</span><span class="token" style="color:#bebec5">}</span><span> </span><span class="token" style="color:#ef3b7d">of</span><span> edges</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span>adjacencyList</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">has</span><span class="token" style="color:#bebec5">(</span><span>start</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      adjacencyList</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">get</span><span class="token" style="color:#bebec5">(</span><span>start</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">push</span><span class="token" style="color:#bebec5">(</span><span>end</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span> </span><span class="token control-flow" style="color:#ef3b7d">else</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      adjacencyList</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">set</span><span class="token" style="color:#bebec5">(</span><span>start</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#bebec5">[</span><span>end</span><span class="token" style="color:#bebec5">]</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>  </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>  </span><span class="token control-flow" style="color:#ef3b7d">for</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">let</span><span> i </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#a77afe">0</span><span class="token" style="color:#bebec5">;</span><span> i </span><span class="token" style="color:#a77afe">&lt;</span><span> nodes</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">length</span><span class="token" style="color:#bebec5">;</span><span> i</span><span class="token" style="color:#a77afe">++</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>    </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#a77afe">!</span><span>adjacencyList</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">has</span><span class="token" style="color:#bebec5">(</span><span>i</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">)</span><span> adjacencyList</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">set</span><span class="token" style="color:#bebec5">(</span><span>i</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#bebec5">[</span><span class="token" style="color:#bebec5">]</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>  </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>  </span><span class="token control-flow" style="color:#ef3b7d">return</span><span> adjacencyList
</span><span></span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span></span><span class="token" style="color:#6f705e">// takes start and end nodes and returns [path_exists, path]</span><span>
</span><span></span><span class="token" style="color:#ef3b7d">function</span><span> </span><span class="token function">bfs</span><span class="token" style="color:#bebec5">(</span><span class="token parameter">start</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> end</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> edges</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> nodes</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>  </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span>start </span><span class="token" style="color:#a77afe">===</span><span> end</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token control-flow" style="color:#ef3b7d">return</span><span> </span><span class="token" style="color:#bebec5">[</span><span class="token" style="color:#a77afe">true</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#bebec5">[</span><span>start</span><span class="token" style="color:#bebec5">]</span><span class="token" style="color:#bebec5">]</span><span>
</span>
<span>  </span><span class="token" style="color:#ef3b7d">const</span><span> adjacencyList </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token function">makeAdjacencyList</span><span class="token" style="color:#bebec5">(</span><span>edges</span><span class="token" style="color:#bebec5">,</span><span> nodes</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span>  </span><span class="token" style="color:#ef3b7d">let</span><span> q </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">[</span><span class="token" style="color:#bebec5">[</span><span>start</span><span class="token" style="color:#bebec5">]</span><span class="token" style="color:#bebec5">]</span><span>
</span><span>  </span><span class="token" style="color:#ef3b7d">let</span><span> seen </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#ef3b7d">new</span><span> </span><span class="token class-name">Set</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">[</span><span>start</span><span class="token" style="color:#bebec5">]</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span>  </span><span class="token control-flow" style="color:#ef3b7d">while</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#a77afe">!</span><span class="token" style="color:#bebec5">(</span><span>q</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color:#a77afe">===</span><span> </span><span class="token" style="color:#a77afe">0</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>    </span><span class="token" style="color:#ef3b7d">const</span><span> q_length </span><span class="token" style="color:#a77afe">=</span><span> q</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">length</span><span>
</span><span>    </span><span class="token control-flow" style="color:#ef3b7d">for</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">let</span><span> i </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#a77afe">0</span><span class="token" style="color:#bebec5">;</span><span> i </span><span class="token" style="color:#a77afe">&lt;</span><span> q_length</span><span class="token" style="color:#bebec5">;</span><span> i</span><span class="token" style="color:#a77afe">++</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      </span><span class="token" style="color:#ef3b7d">const</span><span> path </span><span class="token" style="color:#a77afe">=</span><span> q</span><span class="token" style="color:#bebec5">[</span><span>i</span><span class="token" style="color:#bebec5">]</span><span>
</span><span>      </span><span class="token" style="color:#ef3b7d">const</span><span> curr_node </span><span class="token" style="color:#a77afe">=</span><span> path</span><span class="token" style="color:#bebec5">[</span><span>path</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color:#a77afe">-</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">]</span><span>
</span><span>      </span><span class="token control-flow" style="color:#ef3b7d">for</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">const</span><span> neighbor </span><span class="token" style="color:#ef3b7d">of</span><span> adjacencyList</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">get</span><span class="token" style="color:#bebec5">(</span><span>curr_node</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>        </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span>neighbor </span><span class="token" style="color:#a77afe">===</span><span> end</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>          </span><span class="token control-flow" style="color:#ef3b7d">return</span><span> </span><span class="token" style="color:#bebec5">[</span><span class="token" style="color:#a77afe">true</span><span class="token" style="color:#bebec5">,</span><span> path</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">concat</span><span class="token" style="color:#bebec5">(</span><span>neighbor</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">]</span><span>
</span><span>        </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>        </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#a77afe">!</span><span>seen</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">has</span><span class="token" style="color:#bebec5">(</span><span>neighbor</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>          seen</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">add</span><span class="token" style="color:#bebec5">(</span><span>neighbor</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>          q</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">push</span><span class="token" style="color:#bebec5">(</span><span>path</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">concat</span><span class="token" style="color:#bebec5">(</span><span>neighbor</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>        </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>      </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>    q </span><span class="token" style="color:#a77afe">=</span><span> q</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">slice</span><span class="token" style="color:#bebec5">(</span><span>q_length</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>  </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>  </span><span class="token control-flow" style="color:#ef3b7d">return</span><span> </span><span class="token" style="color:#bebec5">[</span><span class="token" style="color:#a77afe">false</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#bebec5">[</span><span class="token" style="color:#bebec5">]</span><span class="token" style="color:#bebec5">]</span><span>
</span><span></span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span></span><span class="token" style="color:#ef3b7d">function</span><span> </span><span class="token function">highlightPath</span><span class="token" style="color:#bebec5">(</span><span>path</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token function-variable function">onAnimationFinish</span><span> </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token" style="color:#bebec5">{</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">,</span><span> transitionLength </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#a77afe">500</span><span class="token" style="color:#bebec5">,</span><span> delayUnit </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#a77afe">100</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>  d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">selectAll</span><span class="token" style="color:#bebec5">(</span><span class="token template-string template-punctuation" style="color:#e6d06c">`</span><span class="token template-string" style="color:#e6d06c">g.</span><span class="token template-string interpolation interpolation-punctuation" style="color:#bebec5">${</span><span class="token template-string interpolation">styles</span><span class="token template-string interpolation" style="color:#bebec5">.</span><span class="token template-string interpolation property-access">node</span><span class="token template-string interpolation interpolation-punctuation" style="color:#bebec5">}</span><span class="token template-string" style="color:#e6d06c">, g.edge</span><span class="token template-string template-punctuation" style="color:#e6d06c">`</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">transition</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">duration</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#a77afe">300</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">style</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;opacity&quot;</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">0.3</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span>  d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">selectAll</span><span class="token" style="color:#bebec5">(</span><span class="token template-string template-punctuation" style="color:#e6d06c">`</span><span class="token template-string" style="color:#e6d06c">g.</span><span class="token template-string interpolation interpolation-punctuation" style="color:#bebec5">${</span><span class="token template-string interpolation">styles</span><span class="token template-string interpolation" style="color:#bebec5">.</span><span class="token template-string interpolation property-access">node</span><span class="token template-string interpolation interpolation-punctuation" style="color:#bebec5">}</span><span class="token template-string template-punctuation" style="color:#e6d06c">`</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">each</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">(</span><span class="token parameter">_</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> i</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> nodes</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span>path</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">includes</span><span class="token" style="color:#bebec5">(</span><span>i</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>        d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">select</span><span class="token" style="color:#bebec5">(</span><span>nodes</span><span class="token" style="color:#bebec5">[</span><span>i</span><span class="token" style="color:#bebec5">]</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>          </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">transition</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>          </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">duration</span><span class="token" style="color:#bebec5">(</span><span>transitionLength</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>          </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">delay</span><span class="token" style="color:#bebec5">(</span><span>path</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">indexOf</span><span class="token" style="color:#bebec5">(</span><span>i</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#a77afe">*</span><span> </span><span class="token" style="color:#a77afe">2</span><span> </span><span class="token" style="color:#a77afe">*</span><span> delayUnit </span><span class="token" style="color:#a77afe">+</span><span> </span><span class="token" style="color:#a77afe">3</span><span> </span><span class="token" style="color:#a77afe">*</span><span> delayUnit</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>            </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">style</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;opacity&quot;</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>      </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span>  d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">selectAll</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;g.edge&quot;</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">each</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">(</span><span class="token parameter">_</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> i</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> nodes</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">select</span><span class="token" style="color:#bebec5">(</span><span>nodes</span><span class="token" style="color:#bebec5">[</span><span>i</span><span class="token" style="color:#bebec5">]</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>        </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">transition</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>        </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">duration</span><span class="token" style="color:#bebec5">(</span><span>transitionLength</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>        </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">delay</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">(</span><span class="token parameter">d</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>          </span><span class="token control-flow" style="color:#ef3b7d">for</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">let</span><span> j </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#a77afe">0</span><span class="token" style="color:#bebec5">;</span><span> j </span><span class="token" style="color:#a77afe">&lt;</span><span> path</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color:#a77afe">-</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">;</span><span> j</span><span class="token" style="color:#a77afe">++</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>            </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span>path</span><span class="token" style="color:#bebec5">[</span><span>j</span><span class="token" style="color:#bebec5">]</span><span> </span><span class="token" style="color:#a77afe">===</span><span> d</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">start</span><span> </span><span class="token" style="color:#a77afe">&amp;&amp;</span><span> path</span><span class="token" style="color:#bebec5">[</span><span>j </span><span class="token" style="color:#a77afe">+</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">]</span><span> </span><span class="token" style="color:#a77afe">===</span><span> d</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">end</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>              </span><span class="token control-flow" style="color:#ef3b7d">return</span><span> </span><span class="token" style="color:#bebec5">(</span><span>j </span><span class="token" style="color:#a77afe">*</span><span> </span><span class="token" style="color:#a77afe">2</span><span> </span><span class="token" style="color:#a77afe">+</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#a77afe">*</span><span> delayUnit </span><span class="token" style="color:#a77afe">+</span><span> </span><span class="token" style="color:#a77afe">3</span><span> </span><span class="token" style="color:#a77afe">*</span><span> delayUnit
</span><span>            </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>          </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>        </span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>          </span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">style</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;opacity&quot;</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span>  </span><span class="token" style="color:#ef3b7d">const</span><span> animationLength </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">(</span><span>path</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">length</span><span> </span><span class="token" style="color:#a77afe">*</span><span> </span><span class="token" style="color:#a77afe">2</span><span> </span><span class="token" style="color:#a77afe">+</span><span> </span><span class="token" style="color:#a77afe">3</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#a77afe">*</span><span> delayUnit
</span><span>  </span><span class="token function">setTimeout</span><span class="token" style="color:#bebec5">(</span><span>onAnimationFinish</span><span class="token" style="color:#bebec5">,</span><span> animationLength</span><span class="token" style="color:#bebec5">)</span><span>
</span><span></span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span></span><span class="token" style="color:#ef3b7d">class</span><span> </span><span class="token class-name">SkiGraph</span><span> </span><span class="token" style="color:#ef3b7d">extends</span><span> </span><span class="token class-name">React</span><span class="token class-name" style="color:#bebec5">.</span><span class="token class-name">Component</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>  </span><span class="token function">constructor</span><span class="token" style="color:#bebec5">(</span><span class="token parameter">props</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>    </span><span class="token" style="color:#ef3b7d">super</span><span class="token" style="color:#bebec5">(</span><span>props</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    </span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span> </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      start</span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">,</span><span>
</span><span>      end</span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">,</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>  </span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span>  </span><span class="token function">render</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>    </span><span class="token" style="color:#ef3b7d">const</span><span> </span><span class="token function-variable function">reset</span><span> </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      </span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">setState</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">{</span><span>start</span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">,</span><span> end</span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>      d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">selectAll</span><span class="token" style="color:#bebec5">(</span><span class="token template-string template-punctuation" style="color:#e6d06c">`</span><span class="token template-string" style="color:#e6d06c">g.</span><span class="token template-string interpolation interpolation-punctuation" style="color:#bebec5">${</span><span class="token template-string interpolation">styles</span><span class="token template-string interpolation" style="color:#bebec5">.</span><span class="token template-string interpolation property-access">node</span><span class="token template-string interpolation interpolation-punctuation" style="color:#bebec5">}</span><span class="token template-string" style="color:#e6d06c"> circle</span><span class="token template-string template-punctuation" style="color:#e6d06c">`</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">classed</span><span class="token" style="color:#bebec5">(</span><span>styles</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">selected</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">false</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>      d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">selectAll</span><span class="token" style="color:#bebec5">(</span><span class="token template-string template-punctuation" style="color:#e6d06c">`</span><span class="token template-string" style="color:#e6d06c">g.</span><span class="token template-string interpolation interpolation-punctuation" style="color:#bebec5">${</span><span class="token template-string interpolation">styles</span><span class="token template-string interpolation" style="color:#bebec5">.</span><span class="token template-string interpolation property-access">node</span><span class="token template-string interpolation interpolation-punctuation" style="color:#bebec5">}</span><span class="token template-string template-punctuation" style="color:#e6d06c">`</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">transition</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">duration</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#a77afe">500</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">style</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;opacity&quot;</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>      d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">selectAll</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;g.edge&quot;</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">transition</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">duration</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#a77afe">500</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">style</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;opacity&quot;</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">1</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span>    </span><span class="token" style="color:#ef3b7d">let</span><span> displayText
</span><span>    </span><span class="token" style="color:#ef3b7d">let</span><span> onTextClick
</span><span>    </span><span class="token" style="color:#ef3b7d">let</span><span> textClass </span><span class="token" style="color:#a77afe">=</span><span> styles</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">text</span><span>
</span><span>    </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">start</span><span> </span><span class="token" style="color:#a77afe">===</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      displayText </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#e6d06c">&quot;Pick start&quot;</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span> </span><span class="token control-flow" style="color:#ef3b7d">else</span><span> </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">end</span><span> </span><span class="token" style="color:#a77afe">===</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      displayText </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#e6d06c">&quot;Pick end&quot;</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span> </span><span class="token control-flow" style="color:#ef3b7d">else</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      </span><span class="token" style="color:#6f705e">// on this graph there should be a path between every pair of nodes</span><span>
</span><span>      </span><span class="token" style="color:#ef3b7d">const</span><span> </span><span class="token" style="color:#bebec5">[</span><span>_</span><span class="token" style="color:#bebec5">,</span><span> path</span><span class="token" style="color:#bebec5">]</span><span> </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token function">bfs</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">start</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">end</span><span class="token" style="color:#bebec5">,</span><span> edgesData</span><span class="token" style="color:#bebec5">,</span><span> nodesData</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>      </span><span class="token function">highlightPath</span><span class="token" style="color:#bebec5">(</span><span>path</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token function">setTimeout</span><span class="token" style="color:#bebec5">(</span><span>fadeInText</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">500</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>      displayText </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#e6d06c">&quot;Reset&quot;</span><span>
</span><span>      onTextClick </span><span class="token" style="color:#a77afe">=</span><span> reset
</span><span>      textClass </span><span class="token" style="color:#a77afe">+=</span><span> </span><span class="token" style="color:#e6d06c">&quot; &quot;</span><span> </span><span class="token" style="color:#a77afe">+</span><span> styles</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">reset_button</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span>    </span><span class="token control-flow" style="color:#ef3b7d">return</span><span> </span><span class="token" style="color:#bebec5">(</span><span>
</span><span>      </span><span class="token" style="color:#a77afe">&lt;</span><span>div id</span><span class="token" style="color:#a77afe">=</span><span class="token" style="color:#e6d06c">&quot;ski-graph&quot;</span><span> className</span><span class="token" style="color:#a77afe">=</span><span class="token" style="color:#bebec5">{</span><span>styles</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">ski_graph</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#a77afe">&gt;</span><span>
</span><span>        </span><span class="token" style="color:#a77afe">&lt;</span><span>p
</span><span>          onClick</span><span class="token" style="color:#a77afe">=</span><span class="token" style="color:#bebec5">{</span><span>onTextClick</span><span class="token" style="color:#bebec5">}</span><span>
</span><span>          className</span><span class="token" style="color:#a77afe">=</span><span class="token" style="color:#bebec5">{</span><span>textClass</span><span class="token" style="color:#bebec5">}</span><span>
</span><span>        </span><span class="token" style="color:#a77afe">&gt;</span><span class="token" style="color:#bebec5">{</span><span>displayText</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#a77afe">&lt;</span><span class="token" style="color:#a77afe">/</span><span>p</span><span class="token" style="color:#a77afe">&gt;</span><span>
</span>
<span>        </span><span class="token" style="color:#a77afe">&lt;</span><span>svg width</span><span class="token" style="color:#a77afe">=</span><span class="token" style="color:#bebec5">{</span><span class="token constant">SVG_WIDTH</span><span class="token" style="color:#bebec5">}</span><span> height</span><span class="token" style="color:#a77afe">=</span><span class="token" style="color:#bebec5">{</span><span class="token constant">SVG_HEIGHT</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#a77afe">&gt;</span><span class="token" style="color:#a77afe">&lt;</span><span class="token" style="color:#a77afe">/</span><span>svg</span><span class="token" style="color:#a77afe">&gt;</span><span>
</span><span>      </span><span class="token" style="color:#a77afe">&lt;</span><span class="token" style="color:#a77afe">/</span><span>div</span><span class="token" style="color:#a77afe">&gt;</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">)</span><span>
</span><span>  </span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span>  </span><span class="token function">componentDidMount</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>    </span><span class="token" style="color:#ef3b7d">let</span><span> svg </span><span class="token" style="color:#a77afe">=</span><span> d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">select</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#e6d06c">&quot;#ski-graph svg&quot;</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    graphUtils</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">setUpSvg</span><span class="token" style="color:#bebec5">(</span><span>svg</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span>    </span><span class="token" style="color:#ef3b7d">const</span><span> scaledNodes </span><span class="token" style="color:#a77afe">=</span><span> graphUtils</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">scaleNodeData</span><span class="token" style="color:#bebec5">(</span><span>nodesData</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token constant">SVG_WIDTH</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token constant">SVG_HEIGHT</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span>    </span><span class="token" style="color:#ef3b7d">const</span><span> </span><span class="token function-variable function">onNodeClick</span><span> </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token parameter">e</span><span class="token parameter" style="color:#bebec5">,</span><span class="token parameter"> d</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">start</span><span> </span><span class="token" style="color:#a77afe">!=</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span> </span><span class="token" style="color:#a77afe">&amp;&amp;</span><span> </span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">end</span><span> </span><span class="token" style="color:#a77afe">!=</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token control-flow" style="color:#ef3b7d">return</span><span>
</span>
<span>      </span><span class="token" style="color:#ef3b7d">const</span><span> i </span><span class="token" style="color:#a77afe">=</span><span> scaledNodes</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">indexOf</span><span class="token" style="color:#bebec5">(</span><span>d</span><span class="token" style="color:#bebec5">)</span><span>
</span>
<span>      </span><span class="token" style="color:#6f705e">// this is a pretty clumsy way to do animations but it&#x27;s simple enough in this case.</span><span>
</span><span>      </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">start</span><span> </span><span class="token" style="color:#a77afe">==</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>        </span><span class="token function">fadeOutText</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>        </span><span class="token function">setTimeout</span><span class="token" style="color:#bebec5">(</span><span>
</span><span>          </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>            </span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">setState</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">{</span><span>start</span><span class="token" style="color:#a77afe">:</span><span> i</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>            </span><span class="token function">fadeInText</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>          </span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">,</span><span>
</span>          delay
<span>        </span><span class="token" style="color:#bebec5">)</span><span>
</span><span>      </span><span class="token" style="color:#bebec5">}</span><span> </span><span class="token control-flow" style="color:#ef3b7d">else</span><span> </span><span class="token control-flow" style="color:#ef3b7d">if</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">state</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">end</span><span> </span><span class="token" style="color:#a77afe">==</span><span> </span><span class="token null nil" style="color:#ef3b7d">null</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>        </span><span class="token function">fadeOutText</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>        </span><span class="token function">setTimeout</span><span class="token" style="color:#bebec5">(</span><span>
</span><span>          </span><span class="token" style="color:#6f705e">// fading the text back in is handled in a callback after the animation is finished</span><span>
</span><span>          </span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> </span><span class="token" style="color:#ef3b7d">this</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">setState</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">{</span><span>end</span><span class="token" style="color:#a77afe">:</span><span> i</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">,</span><span>
</span>          delay
<span>        </span><span class="token" style="color:#bebec5">)</span><span>
</span><span>      </span><span class="token" style="color:#bebec5">}</span><span>
</span><span>      d3</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">select</span><span class="token" style="color:#bebec5">(</span><span>e</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">target</span><span class="token" style="color:#bebec5">)</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">classed</span><span class="token" style="color:#bebec5">(</span><span>styles</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">selected</span><span class="token" style="color:#bebec5">,</span><span> </span><span class="token" style="color:#a77afe">true</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span>    </span><span class="token" style="color:#ef3b7d">const</span><span> nodeOpts </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      onClick</span><span class="token" style="color:#a77afe">:</span><span> onNodeClick</span><span class="token" style="color:#bebec5">,</span><span>
</span><span>      className</span><span class="token" style="color:#a77afe">:</span><span> styles</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">node</span><span class="token" style="color:#bebec5">,</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span>    </span><span class="token" style="color:#ef3b7d">const</span><span> edgeOpts </span><span class="token" style="color:#a77afe">=</span><span> </span><span class="token" style="color:#bebec5">{</span><span>
</span><span>      </span><span class="token function-variable function">strokeFn</span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token" style="color:#bebec5">(</span><span class="token parameter">d</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token arrow" style="color:#a77afe">=&gt;</span><span> d</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">level</span><span> </span><span class="token" style="color:#a77afe">?</span><span> colorMap</span><span class="token" style="color:#bebec5">[</span><span>d</span><span class="token" style="color:#bebec5">.</span><span class="token property-access">level</span><span class="token" style="color:#bebec5">]</span><span> </span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token" style="color:#e6d06c">&quot;grey&quot;</span><span>
</span><span>    </span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span>    graphUtils</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">renderEdgesD3</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">{</span><span>svg</span><span class="token" style="color:#a77afe">:</span><span> svg</span><span class="token" style="color:#bebec5">,</span><span> edgeData</span><span class="token" style="color:#a77afe">:</span><span> edgesData</span><span class="token" style="color:#bebec5">,</span><span> nodeData</span><span class="token" style="color:#a77afe">:</span><span> scaledNodes</span><span class="token" style="color:#bebec5">,</span><span> directed</span><span class="token" style="color:#a77afe">:</span><span> </span><span class="token" style="color:#a77afe">true</span><span class="token" style="color:#bebec5">,</span><span> opts</span><span class="token" style="color:#a77afe">:</span><span> edgeOpts</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>    graphUtils</span><span class="token" style="color:#bebec5">.</span><span class="token method function property-access">renderNodesD3</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">{</span><span>svg</span><span class="token" style="color:#a77afe">:</span><span> svg</span><span class="token" style="color:#bebec5">,</span><span> nodeData</span><span class="token" style="color:#a77afe">:</span><span> scaledNodes</span><span class="token" style="color:#bebec5">,</span><span> opts</span><span class="token" style="color:#a77afe">:</span><span> nodeOpts</span><span class="token" style="color:#bebec5">}</span><span class="token" style="color:#bebec5">)</span><span>
</span><span>  </span><span class="token" style="color:#bebec5">}</span><span>
</span><span></span><span class="token" style="color:#bebec5">}</span><span>
</span>
<span></span><span class="token" style="color:#6f705e">// Downstream code is set up to display only functional components.</span><span>
</span><span></span><span class="token module" style="color:#ef3b7d">export</span><span> </span><span class="token module" style="color:#ef3b7d">default</span><span> </span><span class="token" style="color:#ef3b7d">function</span><span> </span><span class="token function maybe-class-name">SkiGraphFn</span><span class="token" style="color:#bebec5">(</span><span class="token" style="color:#bebec5">)</span><span> </span><span class="token" style="color:#bebec5">{</span><span> </span><span class="token control-flow" style="color:#ef3b7d">return</span><span> </span><span class="token" style="color:#a77afe">&lt;</span><span class="token maybe-class-name">SkiGraph</span><span> </span><span class="token" style="color:#a77afe">/</span><span class="token" style="color:#a77afe">&gt;</span><span> </span><span class="token" style="color:#bebec5">}</span><span>
</span>
</code></pre></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"sketchData":{"id":"ski_graph","contentHtml":"\u003cp\u003eI recently went skiing at Heavenly resort in South Lake Tahoe, and the process of studying the trail map and picking\nout routes got me thinking about how a ski resort is basically a big directed graph (assuming you stay \"on-piste\").\u003c/p\u003e\n\u003cp\u003eThis inspired me to make a little widget that would find shortest paths between two points in the resort. The result\nis a simplified version of Heavenly that doesn't include the parts that were closed when I was there and\nalso doesn't include advanced terrain that I can't ski down (yet). The grey edges are the chairlifts, and the other edges\nare the runs color-coded by level.\u003c/p\u003e\n\u003cp\u003eTo find a path, click on a start and end node.\u003c/p\u003e\n","code":"import React from 'react'\nimport * as d3 from 'd3'\n\nimport * as graphUtils from '../../lib/graph_utils.js'\n\nimport nodesData from '../../data/graphs/heavenly/nodes.json'\nimport edgesData from '../../data/graphs/heavenly/edges.json'\n\nimport styles from '../../styles/sketches/ski_graph.module.scss'\n\nconst SVG_WIDTH = 500,\n      SVG_HEIGHT = 500\n\nconst colorMap = {\n  \"blue\": \"#1E88E5\",\n  \"green\": \"#229954\"\n}\n\nconst delay = 500\nconst fadeInText  = () =\u003e d3.select(\"#ski-graph .text\").transition().duration(delay).style(\"opacity\", 1)\nconst fadeOutText = () =\u003e d3.select(\"#ski-graph .text\").transition().duration(delay).style(\"opacity\", 0)\n\n// moving these functions out of graphUtils for now.\nfunction makeAdjacencyList(edges, nodes) {\n  let adjacencyList = new Map()\n  for (const {start, end} of edges) {\n    if (adjacencyList.has(start)) {\n      adjacencyList.get(start).push(end)\n    } else {\n      adjacencyList.set(start, [end])\n    }\n  }\n  for (let i = 0; i \u003c nodes.length; i++) {\n    if (!adjacencyList.has(i)) adjacencyList.set(i, [])\n  }\n  return adjacencyList\n}\n\n// takes start and end nodes and returns [path_exists, path]\nfunction bfs(start, end, edges, nodes) {\n  if (start === end) return [true, [start]]\n\n  const adjacencyList = makeAdjacencyList(edges, nodes)\n\n  let q = [[start]]\n  let seen = new Set([start])\n\n  while (!(q.length === 0)) {\n    const q_length = q.length\n    for (let i = 0; i \u003c q_length; i++) {\n      const path = q[i]\n      const curr_node = path[path.length - 1]\n      for (const neighbor of adjacencyList.get(curr_node)) {\n        if (neighbor === end) {\n          return [true, path.concat(neighbor)]\n        }\n        if (!seen.has(neighbor)) {\n          seen.add(neighbor)\n          q.push(path.concat(neighbor))\n        }\n      }\n    }\n    q = q.slice(q_length)\n  }\n  return [false, []]\n}\n\nfunction highlightPath(path, onAnimationFinish = () =\u003e {}, transitionLength = 500, delayUnit = 100) {\n  d3.selectAll(`g.${styles.node}, g.edge`).transition().duration(300).style(\"opacity\", 0.3)\n\n  d3.selectAll(`g.${styles.node}`)\n    .each((_, i, nodes) =\u003e {\n      if (path.includes(i)) {\n        d3.select(nodes[i])\n          .transition()\n          .duration(transitionLength)\n          .delay(path.indexOf(i) * 2 * delayUnit + 3 * delayUnit)\n            .style(\"opacity\", 1)\n      }\n    })\n\n  d3.selectAll(\"g.edge\")\n    .each((_, i, nodes) =\u003e {\n      d3.select(nodes[i])\n        .transition()\n        .duration(transitionLength)\n        .delay((d) =\u003e {\n          for (let j = 0; j \u003c path.length - 1; j++) {\n            if (path[j] === d.start \u0026\u0026 path[j + 1] === d.end) {\n              return (j * 2 + 1)* delayUnit + 3 * delayUnit\n            }\n          }\n        })\n          .style(\"opacity\", 1)\n    })\n\n  const animationLength = (path.length * 2 + 3) * delayUnit\n  setTimeout(onAnimationFinish, animationLength)\n}\n\nclass SkiGraph extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      start: null,\n      end: null,\n    }\n  }\n\n  render() {\n    const reset = () =\u003e {\n      this.setState({start: null, end: null})\n      d3.selectAll(`g.${styles.node} circle`).classed(styles.selected, false)\n      d3.selectAll(`g.${styles.node}`).transition().duration(500).style(\"opacity\", 1)\n      d3.selectAll(\"g.edge\").transition().duration(500).style(\"opacity\", 1)\n    }\n\n    let displayText\n    let onTextClick\n    let textClass = styles.text\n    if (this.state.start === null) {\n      displayText = \"Pick start\"\n    } else if (this.state.end === null) {\n      displayText = \"Pick end\"\n    } else {\n      // on this graph there should be a path between every pair of nodes\n      const [_, path] = bfs(this.state.start, this.state.end, edgesData, nodesData)\n      highlightPath(path, () =\u003e setTimeout(fadeInText, 500))\n      displayText = \"Reset\"\n      onTextClick = reset\n      textClass += \" \" + styles.reset_button\n    }\n\n    return (\n      \u003cdiv id=\"ski-graph\" className={styles.ski_graph}\u003e\n        \u003cp\n          onClick={onTextClick}\n          className={textClass}\n        \u003e{displayText}\u003c/p\u003e\n\n        \u003csvg width={SVG_WIDTH} height={SVG_HEIGHT}\u003e\u003c/svg\u003e\n      \u003c/div\u003e\n    )\n  }\n\n  componentDidMount() {\n    let svg = d3.select(\"#ski-graph svg\")\n    graphUtils.setUpSvg(svg)\n\n    const scaledNodes = graphUtils.scaleNodeData(nodesData, SVG_WIDTH, SVG_HEIGHT)\n\n    const onNodeClick = (e, d) =\u003e {\n      if (this.state.start != null \u0026\u0026 this.state.end != null) return\n\n      const i = scaledNodes.indexOf(d)\n\n      // this is a pretty clumsy way to do animations but it's simple enough in this case.\n      if (this.state.start == null) {\n        fadeOutText()\n        setTimeout(\n          () =\u003e {\n            this.setState({start: i})\n            fadeInText()\n          },\n          delay\n        )\n      } else if (this.state.end == null) {\n        fadeOutText()\n        setTimeout(\n          // fading the text back in is handled in a callback after the animation is finished\n          () =\u003e this.setState({end: i}),\n          delay\n        )\n      }\n      d3.select(e.target).classed(styles.selected, true)\n    }\n\n    const nodeOpts = {\n      onClick: onNodeClick,\n      className: styles.node,\n    }\n\n    const edgeOpts = {\n      strokeFn: (d) =\u003e d.level ? colorMap[d.level] : \"grey\"\n    }\n\n    graphUtils.renderEdgesD3({svg: svg, edgeData: edgesData, nodeData: scaledNodes, directed: true, opts: edgeOpts})\n    graphUtils.renderNodesD3({svg: svg, nodeData: scaledNodes, opts: nodeOpts})\n  }\n}\n\n// Downstream code is set up to display only functional components.\nexport default function SkiGraphFn() { return \u003cSkiGraph /\u003e }\n","codeFilename":"ski_graph.jsx","hasReactComponent":true,"pinned":false,"title":"Ski Graphs","date":"2021-01-28","languages":["js","d3"]}},"__N_SSG":true},"page":"/sketches/[id]","query":{"id":"ski_graph"},"buildId":"45yKvbQKbTqLgeOSwzHQm","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-af28de04c604a2479390.js"></script><script src="/_next/static/chunks/main-eda8c26f5cd99e38033b.js" async=""></script><script src="/_next/static/chunks/webpack-af0eec40afefd136e556.js" async=""></script><script src="/_next/static/chunks/framework.33edf24cd040bcfe1fae.js" async=""></script><script src="/_next/static/chunks/commons.29943283c3fbe2fae039.js" async=""></script><script src="/_next/static/chunks/pages/_app-b1f8c6974db848249dda.js" async=""></script><script src="/_next/static/chunks/fb7d5399.3234374f6f7b41b7b467.js" async=""></script><script src="/_next/static/chunks/fe66c3e56503ac18952228a608ca3464c3766972.f6010f132f2f6ed87439.js" async=""></script><script src="/_next/static/chunks/pages/sketches/%5Bid%5D-9e30c1cc5c676b5407a0.js" async=""></script><script src="/_next/static/45yKvbQKbTqLgeOSwzHQm/_buildManifest.js" async=""></script><script src="/_next/static/45yKvbQKbTqLgeOSwzHQm/_ssgManifest.js" async=""></script></body></html>